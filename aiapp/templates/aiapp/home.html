{% extends "base.html" %}

{% block title %}Home - LearnFlow AI{% endblock %}

{% block content %}
<div class="max-w-5xl mx-auto p-10 mt-12 bg-gradient-to-br from-slate-800 via-slate-700 to-slate-900 rounded-3xl shadow-2xl text-center backdrop-blur-md border border-slate-600 transition-all duration-300">

  <!-- Welcome Message -->
  <h1 class="text-5xl font-extrabold text-white mb-4 tracking-tight animate-fade-in">
    Welcome, {{ user.username }} üëã
  </h1>
  <p class="text-gray-300 text-lg mb-8 font-light">
    You‚Äôve joined a movement where educators and learners rise together‚Äîone joyful click at a time.
  </p>

  <!-- Wikipedia Search -->
  <div class="mb-10 text-left">
    <h2 class="text-2xl font-semibold text-white mb-3">üîç Quick Knowledge Lookup</h2>
    <div class="flex gap-4 items-center">
      <input type="text" id="wikiSearch" placeholder="Search Wikipedia..." class="flex-1 px-4 py-3 rounded-xl bg-slate-900 text-white border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200">
      <button onclick="searchWikipedia()" class="px-5 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-semibold shadow-md">Search</button>
    </div>
    <div id="wikiResult" class="mt-6 text-gray-300"></div>
  </div>

  <!-- Chatbot Section -->
  <div class="mb-10 text-left">
    <h2 class="text-2xl font-semibold text-white mb-3">üí¨ Ask LearnFlow</h2>
    <div class="bg-slate-900 p-6 rounded-2xl border border-slate-700 shadow-inner">
      <div id="chatLog" class="h-48 overflow-y-auto text-gray-300 mb-4 px-2 py-1 bg-slate-800 rounded-lg border border-slate-600"></div>
      <div class="flex gap-4">
        <input type="text" id="chatInput" placeholder="Type your question..." class="flex-1 px-4 py-3 rounded-xl bg-slate-700 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
        <button onclick="sendChat()" class="px-5 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors font-semibold shadow-md">Send</button>
      </div>
    </div>
  </div>
</div>

<!-- Wikipedia API & Chatbot Script -->
<script>
  function searchWikipedia() {
    const query = document.getElementById('wikiSearch').value.trim();
    const resultDiv = document.getElementById('wikiResult');
    if (!query) {
      resultDiv.innerHTML = "<span class='text-yellow-400'>Please enter a topic to search.</span>";
      return;
    }

    resultDiv.innerHTML = "<em>Searching Wikipedia...</em>";

    fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`)
      .then(response => {
        if (!response.ok) throw new Error("Not found");
        return response.json();
      })
      .then(data => {
        if (data.extract) {
          resultDiv.innerHTML = `
            <h3 class="text-lg font-bold mb-2 text-white">${data.title}</h3>
            <p class="text-gray-300">${data.extract}</p>
            <a href="${data.content_urls.desktop.page}" target="_blank" class="text-indigo-400 underline">Read more on Wikipedia</a>
          `;
        } else {
          resultDiv.innerHTML = "<span class='text-red-400'>No summary available. Try a different topic.</span>";
        }
      })
      .catch(() => {
        resultDiv.innerHTML = "<span class='text-red-400'>Topic not found. Try a simpler or more specific term.</span>";
      });
  }

  function sendChat() {
    const input = document.getElementById('chatInput');
    const log = document.getElementById('chatLog');
    const userMessage = input.value.trim();
    if (!userMessage) return;

    log.innerHTML += `<div><strong class="text-green-400">You:</strong> ${userMessage}</div>`;

    const botResponse = getBotResponse(userMessage);
    setTimeout(() => {
      log.innerHTML += `<div><strong class="text-indigo-400">LearnFlow Bot:</strong> ${botResponse}</div>`;
      log.scrollTop = log.scrollHeight;
    }, 600);

    input.value = '';
  }

  function getBotResponse(message) {
    if (message.toLowerCase().includes("upload")) return "To upload content, visit your dashboard and click 'Add Resource'.";
    if (message.toLowerCase().includes("verify")) return "Teacher verification is handled securely‚Äîcheck your profile settings.";
    return "Thanks for your question! Our team is working to make LearnFlow AI even better.";
  }
</script>
{% endblock %}