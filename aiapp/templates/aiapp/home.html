{% extends "base.html" %}

{% block title %}Home - LearnFlow AI{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto p-8 bg-slate-800 rounded-2xl shadow-lg mt-10 text-center">
  <!-- Welcome Message -->
  <h1 class="text-4xl md:text-5xl font-bold text-white mb-4">Welcome, {{ user.username }} 👋</h1>
  <p class="text-gray-400 text-lg mb-6">You’ve joined a movement where educators and learners rise together.</p>

  <!-- Wikipedia Search -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-white mb-2">🔍 Quick Knowledge Lookup</h2>
    <input type="text" id="wikiSearch" placeholder="Search Wikipedia..." class="w-full px-4 py-2 rounded-md bg-slate-900 text-white border border-slate-700 focus:outline-none focus:ring-2 focus:ring-indigo-500 mb-4">
    <button onclick="searchWikipedia()" class="px-4 py-2 bg-indigo-600 text-white rounded-full hover:bg-indigo-700 transition-colors font-semibold">Search</button>
    <div id="wikiResult" class="mt-4 text-left text-gray-300"></div>
  </div>

  <!-- Chatbot Section -->
  <div class="mb-8">
    <h2 class="text-xl font-semibold text-white mb-2">💬 Ask Learnflow</h2>
    <div class="bg-slate-900 p-4 rounded-lg">
      <div id="chatLog" class="h-40 overflow-y-auto text-left text-gray-300 mb-2"></div>
      <input type="text" id="chatInput" placeholder="Type your question..." class="w-full px-4 py-2 rounded-md bg-slate-700 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
      <button onclick="sendChat()" class="mt-2 px-4 py-2 bg-green-600 text-white rounded-full hover:bg-green-700 transition-colors font-semibold">Send</button>
    </div>
  </div>

  <!-- Logout Button -->
  <a href="{% url 'user:logout' %}" class="inline-block px-6 py-3 bg-red-600 text-white rounded-full hover:bg-red-700 transition-colors shadow-lg font-semibold">
  </a>
</div>

<!-- Wikipedia API & Chatbot Script -->
<script>
  function searchWikipedia() {
    const query = document.getElementById('wikiSearch').value;
    const resultDiv = document.getElementById('wikiResult');
    resultDiv.innerHTML = "Searching...";

    fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`)
      .then(response => response.json())
      .then(data => {
        if (data.extract) {
          resultDiv.innerHTML = `<h3 class="text-lg font-bold mb-2">${data.title}</h3><p>${data.extract}</p><a href="${data.content_urls.desktop.page}" target="_blank" class="text-indigo-400 underline">Read more on Wikipedia</a>`;
        } else {
          resultDiv.innerHTML = "input error, please try again later.";
        }
      })
      .catch(() => {
        resultDiv.innerHTML = "input error, please try again later.";
      });
  }

  function sendChat() {
    const input = document.getElementById('chatInput');
    const log = document.getElementById('chatLog');
    const userMessage = input.value.trim();
    if (!userMessage) return;

    log.innerHTML += `<div><strong>You:</strong> ${userMessage}</div>`;

    // Simulated bot response
    const botResponse = getBotResponse(userMessage);
    setTimeout(() => {
      log.innerHTML += `<div><strong>Learnflow Bot:</strong> ${botResponse}</div>`;
      log.scrollTop = log.scrollHeight;
    }, 600);

    input.value = '';
  }

  function getBotResponse(message) {
    // Simple keyword-based responses
    if (message.toLowerCase().includes("upload")) return "To upload content, visit your dashboard and click 'Add Resource'.";
    if (message.toLowerCase().includes("verify")) return "Teacher verification is handled securely—check your profile settings.";
    return "Thanks for your question! Our team is working to make Learnflow even better.";
  }
</script>
{% endblock %}