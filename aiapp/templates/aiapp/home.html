{% extends "base.html" %}

{% block title %}Home - LearnFlow AI{% endblock %}

{% block content %}
<style>
    /* A simple loader for the search state */
    .loader {
        border-top-color: #4f46e5;
        -webkit-animation: spinner 1s linear infinite;
        animation: spinner 1s linear infinite;
    }
    @-webkit-keyframes spinner {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }
    @keyframes spinner {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    /* Style for the selectable suggestions */
    .suggestion-item {
        cursor: pointer;
        transition: all 0.2s;
    }
    .suggestion-item:hover {
        transform: translateX(5px);
        color: #fff;
    }
</style>

<div class="max-w-5xl mx-auto p-4 sm:p-10 mt-6 sm:mt-12 bg-gradient-to-br from-slate-800 via-slate-700 to-slate-900 rounded-2xl sm:rounded-3xl shadow-2xl text-center backdrop-blur-md border border-slate-600 transition-all duration-300">

    <h1 class="text-3xl sm:text-5xl font-extrabold text-white mb-2 sm:mb-4 tracking-tight animate-fade-in">
        Welcome, {{ user.username }} üëã
    </h1>
    <p class="text-sm sm:text-lg text-gray-300 mb-6 sm:mb-8 font-light">
        You‚Äôve joined a movement where educators and learners rise together‚Äîone joyful click at a time.
    </p>

    <div class="mb-6 sm:mb-10 text-left">
        <h2 class="text-xl sm:text-2xl font-semibold text-white mb-2">üîç Quick Knowledge Lookup</h2>
        <div class="bg-slate-900 p-4 sm:p-6 rounded-xl sm:rounded-2xl border border-slate-700 shadow-inner">
            <div id="wikiLog" class="h-48 overflow-y-auto text-gray-300 mb-4 px-2 py-1 bg-slate-800 rounded-lg border border-slate-600"></div>
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="wikiSearch" placeholder="Ask learnflowAi..." class="flex-1 px-4 py-3 rounded-xl bg-slate-700 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200">
                <button onclick="handleWikiSearch()" class="px-5 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-semibold shadow-md">Search</button>
            </div>
        </div>
    </div>

    <div class="mb-6 sm:mb-10 text-left">
        <h2 class="text-xl sm:text-2xl font-semibold text-white mb-2">üí¨ LearnFlow Chat</h2>
        <div class="bg-slate-900 p-4 sm:p-6 rounded-xl sm:rounded-2xl border border-slate-700 shadow-inner">
            <div id="chatLog" class="h-48 overflow-y-auto text-gray-300 mb-4 px-2 py-1 bg-slate-800 rounded-lg border border-slate-600"></div>
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="chatInput" placeholder="Ask learnflowAi......" class="flex-1 px-4 py-3 rounded-xl bg-slate-700 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                <button onclick="sendChat()" class="px-5 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors font-semibold shadow-md">Send</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Wikipedia section functions
    const wikiLog = document.getElementById('wikiLog');
    const wikiSearchInput = document.getElementById('wikiSearch');
    const chatInput = document.getElementById('chatInput');

    // Attach event listeners for Enter key
    wikiSearchInput.addEventListener('keydown', handleEnter);
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            sendChat();
        }
    });

    function appendToWikiLog(html) {
        const div = document.createElement('div');
        div.innerHTML = html;
        wikiLog.appendChild(div);
        wikiLog.scrollTop = wikiLog.scrollHeight;
    }

    function handleEnter(event) {
        if (event.key === 'Enter') {
            handleWikiSearch();
        }
    }

    async function handleWikiSearch() {
        const query = wikiSearchInput.value.trim();
        if (!query) return;

        appendToWikiLog(`<div><strong class="text-green-400">You:</strong> ${query}</div>`);
        wikiSearchInput.value = '';

        appendToWikiLog(`<div class='flex items-center space-x-2'><span>Searching Wikipedia...</span><div class='loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6'></div></div>`);

        await searchWikipedia(query);
    }

    async function searchWikipedia(query) {
        try {
            const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.title || "No direct match found.");
            }

            if (data.type === "disambiguation") {
                const suggestionResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&format=json&origin=*`);
                const suggestions = await suggestionResponse.json();
                const titles = suggestions[1];

                if (titles.length > 0) {
                    let suggestionList = '<p class="text-gray-300">This term has multiple meanings. Did you mean?</p><ul class="list-disc list-inside mt-2 space-y-1">';
                    titles.forEach(title => {
                        suggestionList += `<li><span onclick="searchWikipedia('${title}')" class="suggestion-item text-indigo-400 hover:underline">${title}</span></li>`;
                    });
                    suggestionList += '</ul>';
                    appendToWikiLog(suggestionList);
                } else {
                    appendToWikiLog(`<span class='text-red-400'>Topic not found. Try a different term.</span>`);
                }
            } else if (data.extract) {
                appendToWikiLog(`
                    <div>
                        <strong class="text-indigo-400">LearnFlow Bot:</strong>
                        <h3 class="text-lg font-bold mb-1 text-white">${data.title}</h3>
                        <p class="text-gray-300">${data.extract}</p>
                        <a href="${data.content_urls.desktop.page}" target="_blank" class="text-indigo-400 underline mt-2 inline-block">Read more on Wikipedia</a>
                    </div>
                `);
            } else {
                appendToWikiLog(`<span class='text-red-400'>No summary available.</span> <a href="${data.content_urls.desktop.page}" target="_blank" class="text-indigo-400 underline mt-2 inline-block">Read full article</a>`);
            }

        } catch (error) {
            if (error.message.includes("No direct match found")) {
                const fallbackResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&format=json&origin=*`);
                const suggestions = await fallbackResponse.json();
                const titles = suggestions[1];

                if (titles.length > 0) {
                    let suggestionList = '<p class="text-gray-300">Did you mean?</p><ul class="list-disc list-inside mt-2 space-y-1">';
                    titles.forEach(title => {
                        suggestionList += `<li><span onclick="searchWikipedia('${title}')" class="suggestion-item text-indigo-400 hover:underline">${title}</span></li>`;
                    });
                    suggestionList += '</ul>';
                    appendToWikiLog(suggestionList);
                } else {
                    appendToWikiLog(`<span class='text-red-400'>Topic not found. Please try a different term.</span>`);
                }
            } else {
                appendToWikiLog(`<span class='text-red-400'>An unexpected error occurred. Please try again.</span>`);
            }
        }
    }

    // Original Chatbot section functions
    function sendChat() {
        const input = document.getElementById('chatInput');
        const log = document.getElementById('chatLog');
        const userMessage = input.value.trim();
        if (!userMessage) return;

        log.innerHTML += `<div><strong class="text-green-400">You:</strong> ${userMessage}</div>`;

        const botResponse = getBotResponse(userMessage);
        setTimeout(() => {
            log.innerHTML += `<div><strong class="text-indigo-400">LearnFlow Bot:</strong> ${botResponse}</div>`;
            log.scrollTop = log.scrollHeight;
        }, 600);

        input.value = '';
    }

    function getBotResponse(message) {
        if (message.toLowerCase().includes("upload")) return "To upload content, visit your dashboard and click 'Add Resource'.";
        if (message.toLowerCase().includes("verify")) return "Teacher verification is handled securely‚Äîcheck your profile settings.";
        return "Thanks for your question! Our team is working to make LearnFlow AI even better.";
    }
</script>
{% endblock %}
















































<!-- {% extends "base.html" %}

{% block title %}Home - LearnFlow AI{% endblock %}

{% block content %}
<style>
    /* A simple loader for the search state */
    .loader {
        border-top-color: #4f46e5;
        -webkit-animation: spinner 1s linear infinite;
        animation: spinner 1s linear infinite;
    }
    @-webkit-keyframes spinner {
        0% { -webkit-transform: rotate(0deg); }
        100% { -webkit-transform: rotate(360deg); }
    }
    @keyframes spinner {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
    }
    /* Style for the selectable suggestions */
    .suggestion-item {
        cursor: pointer;
        transition: all 0.2s;
    }
    .suggestion-item:hover {
        transform: translateX(5px);
        color: #fff;
    }
</style>

<div class="max-w-5xl mx-auto p-4 sm:p-10 mt-6 sm:mt-12 bg-gradient-to-br from-slate-800 via-slate-700 to-slate-900 rounded-2xl sm:rounded-3xl shadow-2xl text-center backdrop-blur-md border border-slate-600 transition-all duration-300">

    <h1 class="text-3xl sm:text-5xl font-extrabold text-white mb-2 sm:mb-4 tracking-tight animate-fade-in">
        Welcome, {{ user.username }} üëã
    </h1>
    <p class="text-sm sm:text-lg text-gray-300 mb-6 sm:mb-8 font-light">
        You‚Äôve joined a movement where educators and learners rise together‚Äîone joyful click at a time.
    </p>

    <div class="mb-6 sm:mb-10 text-left">
        <h2 class="text-xl sm:text-2xl font-semibold text-white mb-2">üîç Quick Knowledge Lookup</h2>
        <div class="bg-slate-900 p-4 sm:p-6 rounded-xl sm:rounded-2xl border border-slate-700 shadow-inner">
            <div id="wikiLog" class="h-48 overflow-y-auto text-gray-300 mb-4 px-2 py-1 bg-slate-800 rounded-lg border border-slate-600"></div>
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="wikiSearch" placeholder="Ask learnflowAi..." class="flex-1 px-4 py-3 rounded-xl bg-slate-700 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500 transition-all duration-200">
                <button onclick="handleWikiSearch()" class="px-5 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-semibold shadow-md">Search</button>
            </div>
        </div>
    </div>

    <div class="mb-6 sm:mb-10 text-left">
        <h2 class="text-xl sm:text-2xl font-semibold text-white mb-2">üí¨ LearnFlow Chat</h2>
        <div class="bg-slate-900 p-4 sm:p-6 rounded-xl sm:rounded-2xl border border-slate-700 shadow-inner">
            <div id="chatLog" class="h-48 overflow-y-auto text-gray-300 mb-4 px-2 py-1 bg-slate-800 rounded-lg border border-slate-600"></div>
            <div class="flex flex-col sm:flex-row gap-4">
                <input type="text" id="chatInput" placeholder="Ask learnflowAi......" class="flex-1 px-4 py-3 rounded-xl bg-slate-700 text-white border border-slate-600 focus:outline-none focus:ring-2 focus:ring-green-500 transition-all duration-200">
                <button onclick="sendChat()" class="px-5 py-3 bg-green-600 text-white rounded-xl hover:bg-green-700 transition-colors font-semibold shadow-md">Send</button>
            </div>
        </div>
    </div>
</div>

<script>
    // Wikipedia section functions
    const wikiLog = document.getElementById('wikiLog');
    const wikiSearchInput = document.getElementById('wikiSearch');
    const chatInput = document.getElementById('chatInput');

    // Attach event listeners for Enter key
    wikiSearchInput.addEventListener('keydown', handleEnter);
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
            sendChat();
        }
    });

    function appendToWikiLog(html) {
        const div = document.createElement('div');
        div.innerHTML = html;
        wikiLog.appendChild(div);
        wikiLog.scrollTop = wikiLog.scrollHeight;
    }

    function handleEnter(event) {
        if (event.key === 'Enter') {
            handleWikiSearch();
        }
    }

    async function handleWikiSearch() {
        const query = wikiSearchInput.value.trim();
        if (!query) return;

        appendToWikiLog(`<div><strong class="text-green-400">You:</strong> ${query}</div>`);
        wikiSearchInput.value = '';

        appendToWikiLog(`<div class='flex items-center space-x-2'><span>Searching Wikipedia...</span><div class='loader ease-linear rounded-full border-4 border-t-4 border-gray-200 h-6 w-6'></div></div>`);

        await searchWikipedia(query);
    }

    async function searchWikipedia(query) {
        try {
            const response = await fetch(`https://en.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(query)}`);
            const data = await response.json();

            if (!response.ok) {
                throw new Error(data.title || "No direct match found.");
            }

            if (data.type === "disambiguation") {
                const suggestionResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&format=json&origin=*`);
                const suggestions = await suggestionResponse.json();
                const titles = suggestions[1];

                if (titles.length > 0) {
                    let suggestionList = '<p class="text-gray-300">This term has multiple meanings. Did you mean?</p><ul class="list-disc list-inside mt-2 space-y-1">';
                    titles.forEach(title => {
                        suggestionList += `<li><span onclick="searchWikipedia('${title}')" class="suggestion-item text-indigo-400 hover:underline">${title}</span></li>`;
                    });
                    suggestionList += '</ul>';
                    appendToWikiLog(suggestionList);
                } else {
                    appendToWikiLog(`<span class='text-red-400'>Topic not found. Try a different term.</span>`);
                }
            } else if (data.extract) {
                appendToWikiLog(`
                    <div>
                        <strong class="text-indigo-400">LearnFlow Bot:</strong>
                        <h3 class="text-lg font-bold mb-1 text-white">${data.title}</h3>
                        <p class="text-gray-300">${data.extract}</p>
                        <a href="${data.content_urls.desktop.page}" target="_blank" class="text-indigo-400 underline mt-2 inline-block">Read more on Wikipedia</a>
                    </div>
                `);
            } else {
                appendToWikiLog(`<span class='text-red-400'>No summary available.</span> <a href="${data.content_urls.desktop.page}" target="_blank" class="text-indigo-400 underline mt-2 inline-block">Read full article</a>`);
            }

        } catch (error) {
            if (error.message.includes("No direct match found")) {
                const fallbackResponse = await fetch(`https://en.wikipedia.org/w/api.php?action=opensearch&search=${encodeURIComponent(query)}&limit=5&format=json&origin=*`);
                const suggestions = await fallbackResponse.json();
                const titles = suggestions[1];

                if (titles.length > 0) {
                    let suggestionList = '<p class="text-gray-300">Did you mean?</p><ul class="list-disc list-inside mt-2 space-y-1">';
                    titles.forEach(title => {
                        suggestionList += `<li><span onclick="searchWikipedia('${title}')" class="suggestion-item text-indigo-400 hover:underline">${title}</span></li>`;
                    });
                    suggestionList += '</ul>';
                    appendToWikiLog(suggestionList);
                } else {
                    appendToWikiLog(`<span class='text-red-400'>Topic not found. Please try a different term.</span>`);
                }
            } else {
                appendToWikiLog(`<span class='text-red-400'>An unexpected error occurred. Please try again.</span>`);
            }
        }
    }

    // Original Chatbot section functions
    function sendChat() {
        const input = document.getElementById('chatInput');
        const log = document.getElementById('chatLog');
        const userMessage = input.value.trim();
        if (!userMessage) return;

        log.innerHTML += `<div><strong class="text-green-400">You:</strong> ${userMessage}</div>`;

        const botResponse = getBotResponse(userMessage);
        setTimeout(() => {
            log.innerHTML += `<div><strong class="text-indigo-400">LearnFlow Bot:</strong> ${botResponse}</div>`;
            log.scrollTop = log.scrollHeight;
        }, 600);

        input.value = '';
    }

    function getBotResponse(message) {
        if (message.toLowerCase().includes("upload")) return "To upload content, visit your dashboard and click 'Add Resource'.";
        if (message.toLowerCase().includes("verify")) return "Teacher verification is handled securely‚Äîcheck your profile settings.";
        return "Thanks for your question! Our team is working to make LearnFlow AI even better.";
    }
</script>
{% endblock %} -->
