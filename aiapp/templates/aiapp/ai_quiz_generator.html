<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate AI-Powered Learning Paths</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles to set a dark background for the whole page and enable pulse for loading */
        body {
            background-color: #1e293b; /* slate-800 equivalent background */
        }
        /* Style for the rendered Markdown */
        .markdown-output h2 { font-size: 1.5rem; font-weight: bold; color: #a5b4fc; margin-top: 1.5rem; border-bottom: 1px solid #475569; padding-bottom: 0.5rem; }
        .markdown-output h3 { font-size: 1.25rem; font-weight: bold; color: #c7d2fe; margin-top: 1rem; }
        .markdown-output p { margin-bottom: 0.75rem; }
        .markdown-output ul { list-style-type: disc; margin-left: 1.5rem; margin-bottom: 0.75rem; }
        .markdown-output li { margin-bottom: 0.25rem; }
        .quiz-input-container { margin-top: 1rem; }
        .quiz-input-container label { display: block; margin-bottom: 0.5rem; font-weight: 500; color: #cbd5e1; }
        .quiz-input-container input { width: 100%; padding: 0.5rem; border-radius: 0.375rem; background-color: #1e293b; border: 1px solid #475569; color: #fff; }

        /* Quiz/Lesson Modal Specific Styles */
        .question-block { background-color: #1f2937; padding: 1rem; border-radius: 0.5rem; margin-bottom: 1rem; border: 1px solid #475569; }
        .quiz-question { font-weight: bold; color: #f9fafb; margin-bottom: 0.75rem; }
        .fill-in-box { width: 100%; padding: 0.5rem; border-radius: 0.375rem; background-color: #1e293b; border: 1px solid #6366f1; color: #fff; margin-top: 0.5rem; }
    </style>
</head>
<body>

<div class="max-w-4xl mx-auto p-8 bg-slate-800 rounded-2xl shadow-lg w-full mt-10 relative">

    <div class="text-center mb-12">
        <h2 class="text-4xl md:text-5xl font-extrabold text-white mb-4">Generate AI-Powered Learning Paths</h2>
        <p class="text-xl text-gray-400 max-w-2xl mx-auto">
            Create personalized courses for tech skills, digital marketing, or language learning!
            <div class="text-yellow-400 text-sm mt-2">üåç Multilingual Remix Mode Activated</div>
        </p>
    </div>

    <div class="flex flex-col lg:flex-row gap-8">
        
        <div class="lg:w-7/12 bg-slate-700 p-8 rounded-2xl shadow-inner">
            <h3 class="text-2xl font-bold text-gray-200 mb-2 flex items-center">
                <span class="text-indigo-400 mr-3">üéØ</span>
                What Would You Like to Master Today?
            </h3>
            <p class="text-gray-400 mb-6">
                Fill in your choices and we'll create a step-by-step learning path for you.
            </p>

            <form id="learningPathForm" class="space-y-6">
                <div>
                    <label for="languageSelect" class="block text-lg font-medium text-gray-200 mb-2">Choose Course Output Language üåê</label>
                    <select id="languageSelect" class="w-full px-4 py-3 rounded-xl bg-slate-800 text-gray-200 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="en-US">English (US)</option>
                        <option value="fr-FR">French (France)</option>
                        <option value="es-ES">Spanish (Spain)</option>
                        <option value="sw">Swahili (Kenya/Tanzania)</option>
                        <option value="yo">Yoruba (Nigeria)</option>
                        <option value="zu">Zulu (South Africa)</option>
                        <option value="ar">Arabic</option>
                        <option value="zh">Mandarin Chinese</option>
                    </select>
                </div>
                
                <div>
                    <label for="subjectMastery" class="block text-lg font-medium text-gray-200 mb-2">What subject do you want to master? *</label>
                    <input type="text" id="subjectMastery" placeholder="e.g. Learning Swahili Grammar" required class="w-full px-4 py-3 rounded-xl bg-slate-800 text-gray-200 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                </div>

                <div class="text-sm text-gray-400">
                    <p class="font-semibold mb-2">üí° Popular subjects:</p>
                    <div class="flex flex-wrap gap-2">
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Beginner React Development'">Beginner React Dev</span>
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Intermediate Machine Learning Basics'">Intermediate ML Basics</span>
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Digital Marketing Strategy'">Digital Marketing Strategy</span>
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Advanced Swahili Conversation'">Advanced Swahili</span>
                    </div>
                    <div class="flex flex-wrap gap-2 mt-2">
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Beginner Yoruba Tones'">Beginner Yoruba</span>
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Intermediate Data Science with Python'">Data Science</span>
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Advanced UI/UX Principles'">Advanced UI/UX</span>
                        <span class="bg-slate-600/50 text-indigo-300 px-3 py-1 rounded-full text-xs cursor-pointer hover:bg-slate-600" onclick="document.getElementById('subjectMastery').value = 'Intermediate French Verb Conjugation'">Intermediate French</span>
                    </div>
                </div>
                
                <div>
                    <label for="currentLevel" class="block text-lg font-medium text-gray-200 mb-2">What's your current level? üìö</label>
                    <select id="currentLevel" class="w-full px-4 py-3 rounded-xl bg-slate-800 text-gray-200 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500">
                        <option value="beginner">Beginner (Just starting)</option>
                        <option value="intermediate">Intermediate (Some experience)</option>
                        <option value="advanced">Advanced (Experienced)</option>
                    </select>
                </div>

                <div>
                    <label for="learningGoals" class="block text-lg font-medium text-gray-200 mb-2">Any specific learning goals or preferences? üéì</label>
                    <textarea id="learningGoals" rows="3" placeholder="e.g. Focus on practical projects, need a certificate, 3 hours per week commitment." class="w-full px-4 py-3 rounded-xl bg-slate-800 text-gray-200 border border-slate-600 focus:outline-none focus:ring-2 focus:ring-indigo-500"></textarea>
                </div>

                <button type="button" onclick="generateCourseOutline(false)" id="generateButton" class="w-full px-6 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-colors font-bold text-lg flex items-center justify-center shadow-lg">
                    <span class="mr-2">üöÄ</span>
                    Create My Learning Path
                </button>
                <p id="aiStatus" class="text-sm text-gray-400 mt-4 text-center"></p>

            </form>
        </div>

        <div class="lg:w-5/12 bg-slate-700 p-8 rounded-2xl shadow-inner border border-indigo-500/50">
            <h4 class="text-xl font-bold text-gray-200 mb-6 flex items-center">
                <span class="mr-2 text-yellow-400">‚ú®</span>
                Your personalized learning journey will include:
            </h4>
            <ul class="space-y-4 text-gray-300 font-medium">
                <li class="flex items-start">
                    <span class="text-green-400 mr-3 text-xl font-bold">‚úì</span>
                    <span class="leading-relaxed">**Interactive lessons** based on your pace.</span>
                </li>
                <li class="flex items-start">
                    <span class="text-green-400 mr-3 text-xl font-bold">‚úì</span>
                    <span class="leading-relaxed">**Hands-on practice exercises** for skill retention.</span>
                </li>
                <li class="flex items-start">
                    <span class="text-green-400 mr-3 text-xl font-bold">‚úì</span>
                    <span class="leading-relaxed">**Curated learning resources** and external links.</span>
                </li>
                <li class="flex items-start">
                    <span class="text-green-400 mr-3 text-xl font-bold">‚úì</span>
                    <span class="leading-relaxed">**Progress tracking & achievements** to keep you motivated.</span>
                </li>
            </ul>
        </div>
    </div>
    
    <div id="aiCourseOutput" class="hidden bg-slate-700 p-6 rounded-xl shadow-inner mt-10">
        <h4 class="text-lg font-semibold text-indigo-400 mb-4 border-b border-slate-600 pb-2">Generated Learning Path Outline</h4>
        <div id="courseContent" class="space-y-4 text-gray-300">
            </div>
        
        <div class="quiz-input-container">
            <label for="quizPromptInput" class="text-sm">Current Subject Focus (Used for AI Context):</label>
            <input type="text" id="quizPromptInput" value="" disabled class="mt-1 bg-slate-800/50 border-slate-600">
        </div>

        <div class="text-center mt-6 flex flex-wrap justify-center items-center gap-4">
            <button onclick="generateCourseOutline(true)" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition-colors font-semibold text-sm">
                üîÑ Regenerate Outline
            </button>
            <button onclick="generatePdf('courseContent')" class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-semibold text-sm">
                ‚¨áÔ∏è Download TXT
            </button>
            <button class="px-6 py-2 bg-green-600 text-white rounded-lg font-semibold disabled:bg-green-800" disabled>
                Enroll in Course (Coming Soon)
            </button>
        </div>
    </div>
    
    <div id="quizModal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50">
        <div class="bg-slate-700 p-8 rounded-xl max-w-2xl w-full shadow-2xl relative">
            <h3 class="text-2xl font-bold text-yellow-400 mb-4">Lesson Details üìñ</h3>
            <div id="quizContent" class="text-gray-300 space-y-4 max-h-96 overflow-y-auto pr-2">
                </div>
            <div id="quizStatus" class="text-sm text-center mt-4 text-indigo-300"></div>
            
            <div class="flex flex-col gap-3 mt-6">
                <button onclick="document.getElementById('quizModal').classList.add('hidden')" class="w-full px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 font-semibold">
                    ‚¨ÖÔ∏è Back to Course Outline
                </button>
            </div>
        </div>
    </div>

</div>

<script>
// API Key for Gemini 
const GEMINI_API_KEY = "AIzaSyCQyFKkQWHKJCKtSNlzggDzCT4u5EnzHFw"; 
const CACHE_KEY_PREFIX = "learnflow_outline_";

// --- Utility Functions (Speak, Markdown, PDF) remain the same ---

/**
 * Cleans Markdown symbols and uses the Web Speech API.
 */
function speakText(text) {
    const selectedLang = document.getElementById("languageSelect").value;
    
    // 1. Clean Markdown symbols and flow disruptors for clearer speech
    let cleanText = text
        .replace(/##/g, 'Section')      
        .replace(/\*\*/g, '')           
        .replace(/- /gm, '. ')          
        .replace(/:\s/g, '.\n')         
        .replace(/\//g, ' or ')         
        .replace(/(\r\n|\n|\r)/gm, ' ') 
        .replace(/ +/g, ' ');           

    const utterance = new SpeechSynthesisUtterance(cleanText);
    utterance.lang = selectedLang;
    utterance.rate = 0.95;
    
    speechSynthesis.cancel();
    speechSynthesis.speak(utterance);
}

// Placeholder for full Markdown to HTML converter (simplified here)
function markdownToHtml(markdown) {
    let html = markdown;
    html = html.replace(/^## (.*)$/gim, '<h3>$1</h3>');
    html = html.replace(/^# (.*)$/gim, '<h2>$1</h2>');
    html = html.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
    html = html.replace(/__(.*?)__/g, '<strong>$1</strong>');
    
    // Simple list rendering - requires proper splitting for clean output
    html = html.split('\n').map(line => {
        if (line.startsWith('- ')) return `<li>${line.substring(2).trim()}</li>`;
        return line;
    }).join('\n');
    
    // Add paragraph tags if not a list or heading (simplified)
    html = html.replace(/([^\n])\n(?!<h|<u|<l)/g, '$1\n\n')
               .replace(/([^\n])\n\n(?!<h|<u|<l)/g, '<p>$1</p>')
               .replace(/<li>.*<\/li>/gs, (match) => `<ul>${match}</ul>`);

    return html;
}

/**
 * Placeholder function for TXT Download
 */
function generatePdf(elementId) {
    const title = document.querySelector('#aiCourseOutput h4').textContent;
    const contentHtml = document.getElementById(elementId).innerHTML;
    
    const tempDiv = document.createElement('div');
    tempDiv.innerHTML = contentHtml;
    const content = tempDiv.innerText;

    const fullText = title + "\n\n" + content;
    const blob = new Blob([fullText], { type: 'text/plain;charset=utf-8' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = title.replace(/ /g, '_') + ".txt";
    link.click();
    URL.revokeObjectURL(url);
    alert("Downloaded the outline as a text file.");
}


// --- AI Fetch Function (Simplified to only allow text output) ---
async function fetchAiContent(prompt, model = 'gemini-2.5-flash') {
    try {
        const endpoint = "https://generativelanguage.googleapis.com/v1/models/" + model + ":generateContent?key=" + GEMINI_API_KEY;
        
        const body = {
            contents: [{ 
                role: "user",
                parts: [{ text: prompt }] 
            }]
        };
        // NOTE: We intentionally remove generationConfig to avoid the 400 error.
        
        const response = await fetch(endpoint, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });

        if (!response.ok) {
             const errorData = await response.json().catch(() => ({ error: { message: `Request failed with status ${response.status}.` } }));
            throw new Error(`API call failed with status ${response.status}. Message: ${errorData.error.message || "No message provided."}`);
        }

        const data = await response.json();
        const text = data?.candidates?.[0]?.content?.parts?.[0]?.text;

        if (text && text.trim() !== "") {
            return text; 
        } else {
            throw new Error(`Model returned empty content or was blocked.`);
        }

    } catch (error) {
        throw error;
    }
}


/**
 * Main function to generate the course outline, using caching and OFFLINE fallback on failure.
 */
async function generateCourseOutline(forceRegenerate = false) {
    const topic = document.getElementById("subjectMastery").value.trim();
    const level = document.getElementById("currentLevel").value;
    const goals = document.getElementById("learningGoals").value.trim();
    const selectedLang = document.getElementById("languageSelect").value;
    const cacheKey = CACHE_KEY_PREFIX + selectedLang + "_" + topic.toLowerCase().replace(/\s/g, '_');
    
    const status = document.getElementById("aiStatus");
    const output = document.getElementById("aiCourseOutput");
    const content = document.getElementById("courseContent");
    const generateButton = document.getElementById("generateButton");

    if (!topic) {
        status.textContent = "‚ö†Ô∏è Please enter a subject to create your learning path.";
        return;
    }
    
    // Set quiz prompt input for reference
    document.getElementById("quizPromptInput").value = `${topic} (${level})`;

    // 1. Check Cache
    if (!forceRegenerate) {
        const cachedText = localStorage.getItem(cacheKey);
        if (cachedText && cachedText.startsWith('AI_OUTPUT:')) {
            displayOutline(topic, cachedText.replace('AI_OUTPUT:', ''), false); 
            status.textContent = "üíæ Loaded personalized learning path from local cache.";
            return;
        } else if (cachedText && cachedText.startsWith('OFFLINE_OUTPUT:')) {
            content.innerHTML = cachedText.replace('OFFLINE_OUTPUT:', '');
            displayOutline(topic, content.innerHTML, true);
            status.innerHTML = `üíæ Loaded **Offline Remix** path from cache. <span class="text-yellow-400">üéâ Remix Mode Active!</span>`;
            return;
        }
    }

    // 2. Set Loading State
    status.innerHTML = `<span class="animate-pulse text-indigo-400">‚è≥ Generating ${level} course on "${topic}" in ${selectedLang}...</span>`;
    generateButton.disabled = true;
    generateButton.classList.remove('hover:bg-indigo-700');
    generateButton.classList.add('bg-indigo-800/70', 'cursor-not-allowed');
    output.classList.add("hidden");
    content.innerHTML = "";

    try {
        const prompt = `You are LearnFlow AI Course Generator. Respond STRICTLY in the language corresponding to the BCP-47 code: ${selectedLang}. Create a 5-step learning path outline for the subject: "${topic}". 
                        The user's current level is "${level}" and their goals are: "${goals}". 
                        For each step, include a title using a H2 heading (##), a brief goal, and a list of 3-4 key concepts or lessons using bullet points (-). DO NOT include any introductory or concluding remarks, only the formatted outline.`;

        const generatedText = await fetchAiContent(prompt, 'gemini-2.5-flash');

        // 3. Save AI Output to Cache and Display
        localStorage.setItem(cacheKey, 'AI_OUTPUT:' + generatedText);
        displayOutline(topic, generatedText, false); 
        status.textContent = "‚úÖ Your personalized learning path is ready! (Outline is cached locally)";

    } catch (error) {
        // --- OFFLINE FALLBACK / REMIX MODE ACTIVATED ---
        console.error("Gemini API Error (Activating Offline Fallback):", error);
        
        // Use the Digital Marketing Outline as the new fixed fallback
        const offlineContent = generateOfflineCourse(topic, level, goals, selectedLang);
        
        // Save Offline content to Cache
        localStorage.setItem(cacheKey, 'OFFLINE_OUTPUT:' + offlineContent);

        content.innerHTML = offlineContent; 
        displayOutline(topic, content.innerHTML, true); 

        status.innerHTML = `‚ùå Quiz generation failed: ${error.message}. <span class="text-yellow-400">üéâ Remix Mode Activated (Using Fixed Digital Marketing Path)!</span>`;
        speakText(`Remix mode activated. Here's your fixed learning path.`);
    } finally {
        // 5. Reset Button State
        generateButton.disabled = false;
        generateButton.classList.remove('bg-indigo-800/70', 'cursor-not-allowed');
        generateButton.classList.add('hover:bg-indigo-700');
    }
}

/**
 * Helper function to inject generated text into the DOM.
 */
function displayOutline(topic, text, isHtmlMode = false) {
    const output = document.getElementById("aiCourseOutput");
    const content = document.getElementById("courseContent");
    
    document.querySelector('#aiCourseOutput h4').textContent = `Generated Learning Path Outline for: ${topic}`;

    content.innerHTML = ''; // Clear previous content
    
    const outlineBlock = document.createElement("div");
    outlineBlock.className = "p-4 rounded-lg mb-4 markdown-output";

    if (isHtmlMode) {
        // Offline mode: content is already structured HTML with onclick handlers
        outlineBlock.innerHTML = text;
    } else {
        // AI mode: content is raw markdown/text, convert and display as HTML. 
        // NOTE: AI output is NOT yet designed for click-to-expand, it shows a static outline.
        const htmlContent = markdownToHtml(text);
        outlineBlock.innerHTML = htmlContent;
    }
    
    // Add Read Aloud button (for both modes)
    const readAloudButton = document.createElement('button');
    readAloudButton.className = "mt-2 px-4 py-1 bg-green-600 text-white rounded hover:bg-green-700 text-xs";
    readAloudButton.textContent = "üîä Read Aloud Outline";
    readAloudButton.onclick = () => speakText(isHtmlMode ? outlineBlock.innerText : text); 
    outlineBlock.appendChild(readAloudButton);
    
    content.appendChild(outlineBlock);
    output.classList.remove("hidden");
}


// --- OFFLINE FALLBACK COURSE FUNCTION (NEW IMPLEMENTATION) ---
function generateOfflineCourse(topic, level, goals, langCode) {
    // Fixed outline based on user request (Digital Marketing)
    let steps = [
        {
            title: "Step 1: Understanding the Digital Landscape & Your Online Footprint",
            goal: "Grasp the core components of digital marketing and establish foundational online presences.",
            lessons: [
                "What is Digital Marketing? (Channels, benefits, vs. traditional)",
                "Identifying Your Target Audience & Customer Journey Basics",
                "Setting Up Essential Online Profiles (e.g., Google My Business, basic social media page)",
                "Introduction to Marketing Funnels (Awareness, Consideration, Conversion)"
            ],
            detail: `
                <h4 class="text-xl font-bold text-indigo-400 mb-3">Understanding the Digital Landscape</h4>
                <p class="text-gray-300 mb-4">
                    **Digital marketing** uses electronic channels (like search engines, social media, email) to promote products or services. It is measurable, cost-effective, and highly targeted, giving it a massive edge over traditional methods.
                </p>
                <p class="text-gray-300 mb-4">
                    Before any campaign, you must define your **Target Audience**. Understand their demographics, pain points, and where they spend time online. This informs their **Customer Journey**‚Äîthe path from awareness to purchase. Setting up your basic online presence (GMB, core social media) is the first physical step into the digital landscape.
                </p>
                <div class="p-4 bg-slate-600/50 rounded-lg mt-6">
                    <h5 class="text-lg font-bold text-yellow-300 mb-3">Self-Assessment Questions</h5>
                    <p class="text-gray-300">
                        <strong>Q1.</strong> Name three digital marketing channels. (Answer: SEO/Search, Social Media, Email, Paid Ads).
                    </p>
                    <p class="text-gray-300 mt-2">
                        <strong>Q2.</strong> What are the three core stages of the Marketing Funnel? (Answer: Awareness, Consideration, Conversion).
                    </p>
                </div>
            `
        },
        {
            title: "Step 2: Website Essentials & Search Engine Optimization (SEO) Kickstart",
            goal: "Understand the role of a website and implement basic strategies to get found online.",
            lessons: [
                "The Importance of a Website or Landing Page",
                "Introduction to Search Engine Optimization (SEO) & How Search Engines Work",
                "Practical Keyword Research for Beginners (identifying what people search for)",
                "On-Page SEO Fundamentals (titles, descriptions, content structure, basic linking)"
            ],
            detail: `
                <h4 class="text-xl font-bold text-indigo-400 mb-3">SEO Kickstart</h4>
                <p class="text-gray-300 mb-4">
                    Your **website** is your central digital hub. **SEO** is the practice of increasing the quantity and quality of traffic to your website through organic (non-paid) search engine results. Search engines use complex algorithms to crawl, index, and rank content based on relevance and authority.
                </p>
                <p class="text-gray-300 mb-4">
                    **Keyword Research** is the process of finding the words and phrases your target audience uses in search engines. You use these keywords strategically in your **On-Page SEO**: page titles, meta descriptions, and header tags (&lt;h1&gt;, &lt;h2&gt;).
                </p>
                <div class="p-4 bg-slate-600/50 rounded-lg mt-6">
                    <h5 class="text-lg font-bold text-yellow-300 mb-3">Self-Assessment Questions</h5>
                    <p class="text-gray-300">
                        <strong>Q1.</strong> What is the difference between On-Page and Off-Page SEO? (Answer: On-Page refers to elements you control on your site; Off-Page refers to external signals, like backlinks).
                    </p>
                    <p class="text-gray-300 mt-2">
                        <strong>Q2.</strong> Why are Title Tags important for SEO? (Answer: They are the main headline shown in search results and a primary signal to search engines about the page's content).
                    </p>
                </div>
            `
        },
        {
            title: "Step 3: Engaging with Content & Social Media Marketing",
            goal: "Learn to create simple, effective content and leverage social media for audience engagement.",
            lessons: [
                "Fundamentals of Content Marketing (blogs, videos, images)",
                "Crafting Compelling Social Media Posts (text, visuals, calls to action)",
                "Choosing the Right Social Media Platforms for Your Goals",
                "Basic Social Media Analytics & Engagement Metrics"
            ],
            detail: `
                <h4 class="text-xl font-bold text-indigo-400 mb-3">Content & Social Media Strategy</h4>
                <p class="text-gray-300 mb-4">
                    **Content Marketing** is creating and distributing valuable, relevant, and consistent content (blogs, video, infographics) to attract and retain a clearly defined audience. **Social Media Marketing** is about promoting your content and engaging directly with your audience on platforms like Facebook, Instagram, or LinkedIn.
                </p>
                <p class="text-gray-300 mb-4">
                    Each post needs a clear **Call to Action (CTA)**. Metrics like **Engagement Rate** (likes, comments, shares divided by reach) are crucial to understanding if your content is resonating. Always choose platforms where your target audience is most active.
                </p>
                <div class="p-4 bg-slate-600/50 rounded-lg mt-6">
                    <h5 class="text-lg font-bold text-yellow-300 mb-3">Self-Assessment Questions</h5>
                    <p class="text-gray-300">
                        <strong>Q1.</strong> What does "CTA" stand for and what is its purpose? (Answer: Call to Action; to prompt the user to take a specific next step).
                    </p>
                    <p class="text-gray-300 mt-2">
                        <strong>Q2.</strong> Give an example of an Engagement Metric. (Answer: Likes, Comments, Shares, Saves).
                    </p>
                </div>
            `
        },
        {
            title: "Step 4: Email Marketing & Introduction to Paid Advertising",
            goal: "Discover how to communicate directly with your audience and explore paid promotional channels.",
            lessons: [
                "Building a Basic Email List & Email Marketing Best Practices",
                "Crafting Effective Email Campaigns (subject lines, content, simple automation)",
                "Introduction to Paid Search Advertising (e.g., Google Ads concepts, ad structure)",
                "Introduction to Social Media Advertising (e.g., Facebook/Instagram Ads concepts, targeting)"
            ],
            detail: `
                <h4 class="text-xl font-bold text-indigo-400 mb-3">Email and Paid Channels</h4>
                <p class="text-gray-300 mb-4">
                    **Email marketing** is one of the highest ROI channels. **Best practices** include double opt-in, segmenting your list, and crafting clear, concise subject lines. **Automation** allows you to send emails based on user behavior (e.g., welcome series).
                </p>
                <p class="text-gray-300 mb-4">
                    **Paid Advertising** provides instant visibility. **Google Ads** targets users based on their search intent (keywords), while **Social Media Ads** (Facebook, Instagram) target users based on demographics, interests, and behaviors. Effective targeting is key to minimizing costs.
                </p>
                <div class="p-4 bg-slate-600/50 rounded-lg mt-6">
                    <h5 class="text-lg font-bold text-yellow-300 mb-3">Self-Assessment Questions</h5>
                    <p class="text-gray-300">
                        <strong>Q1.</strong> What is the main benefit of using Email Automation? (Answer: It saves time and ensures timely, relevant messages are sent to users based on triggers).
                    </p>
                    <p class="text-gray-300 mt-2">
                        <strong>Q2.</strong> What is the primary difference in targeting between Google Search Ads and Facebook Ads? (Answer: Google Ads targets search intent (what users are looking for); Facebook Ads targets user profile and interests (who the users are)).
                    </p>
                </div>
            `
        },
        {
            title: "Step 5: Measuring Success & Developing a Practical Plan",
            goal: "Understand how to track performance, make data-driven decisions, and outline a simple digital marketing plan.",
            lessons: [
                "Basic Web Analytics with Google Analytics (understanding traffic, bounce rate, conversions)",
                "Setting SMART Goals for Digital Marketing Campaigns",
                "Creating a Simple Digital Marketing Strategy & Content Calendar",
                "Practical Exercise: Develop a Mini-Campaign Plan for a Hypothetical Business"
            ],
            detail: `
                <h4 class="text-xl font-bold text-indigo-400 mb-3">Measurement and Strategy</h4>
                <p class="text-gray-300 mb-4">
                    You can't manage what you don't measure. **Web Analytics** (like Google Analytics) helps you understand visitor behavior: where they come from (traffic), how long they stay (bounce rate), and if they complete a desired action (**conversions**).
                </p>
                <p class="text-gray-300 mb-4">
                    All goals should be **SMART**: **S**pecific, **M**easurable, **A**chievable, **R**elevant, **T**ime-bound. Once goals are set, you can build a **Digital Marketing Strategy**‚Äîa roadmap for all your channels‚Äîand organize it with a **Content Calendar**.
                </p>
                <div class="p-4 bg-slate-600/50 rounded-lg mt-6">
                    <h5 class="text-lg font-bold text-yellow-300 mb-3">Self-Assessment Questions</h5>
                    <p class="text-gray-300">
                        <strong>Q1.</strong> What does the "M" in the SMART goal framework stand for? (Answer: Measurable).
                    </p>
                    <p class="text-gray-300 mt-2">
                        <strong>Q2.</strong> Give one example of a key metric you would track in a web analytics tool. (Answer: Traffic, Conversions, Bounce Rate, or Time on Page).
                    </p>
                </div>
            `
        }
    ];

    // Store the steps globally in the DOM for easy retrieval when clicking.
    document.body.dataset.offlineSteps = JSON.stringify(steps);

    // Generate the outline HTML
    let output = '';
    steps.forEach((step, index) => {
        output += `
            <div class="bg-slate-800 p-4 rounded-lg border border-slate-600 mb-4 cursor-pointer hover:bg-slate-700/70 transition-colors"
                 onclick="displayDetailedLesson(${index}, '${topic}')">
                <h5 class="text-indigo-300 font-bold mb-2">${step.title}</h5>
                <p class="text-gray-400 mb-2"><strong>Goal:</strong> ${step.goal}</p>
                <ul class="list-disc list-inside text-gray-300">
                    ${step.lessons.map(lesson => `<li>${lesson}</li>`).join("")}
                </ul>
                <p class="text-sm text-yellow-400 mt-2">üëâ Click to view detailed lesson and self-quiz</p>
            </div>
        `;
    });
    return output;
}

/**
 * NEW FUNCTION: Displays the detailed lesson content and non-interactive quiz.
 */
function displayDetailedLesson(index, topic) {
    const steps = JSON.parse(document.body.dataset.offlineSteps);
    const step = steps[index];

    const quizModal = document.getElementById("quizModal");
    const quizContentDiv = document.getElementById("quizContent");
    const quizStatusDiv = document.getElementById("quizStatus");

    // 1. Configure Modal for Lesson Content
    document.querySelector('#quizModal h3').textContent = `Lesson: ${step.title}`;
    quizContentDiv.innerHTML = step.detail;
    quizStatusDiv.textContent = `Lesson details for ${topic}. This content is available offline. Use the questions to test yourself.`;
    
    // 2. Show Modal
    quizModal.classList.remove('hidden');
    
    // Optional: Speak the title
    speakText(step.title);
}

// NOTE: All previously failed/unnecessary quiz functions (displayInteractiveQuiz, submitQuiz, generateQuiz, generateOfflineQuiz) have been removed or commented out for a cleaner, more reliable codebase focusing on the new interactive outline.

</script>
</body>
</html>