{% load static %}
<!DOCTYPE html>
<html lang="en" class="dark">
<head>
   
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}LearnFlow AI{% endblock %}</title>
    <script src="https://cdn.tailwindcss.com"></script>
    
    {% if user.is_authenticated %}
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-9564790727166506"
     crossorigin="anonymous"></script>
    {% endif %}
   
     <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "FAQPage",
      "mainEntity": [{
        "@type": "Question",
        "name": "What is LearnFlow AI?",
        "acceptedAnswer": {
          "@type": "Answer",
          "text": "LearnFlow AI is a multilingual educational platform offering quizzes, books, and videos for African educators and students."
        }
      }]
    }
    </script>
    

    <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "EducationalOrganization",
      "name": "LearnFlow AI",
      "url": "https://learnflow-ai-0fdz.onrender.com",
      "logo": "https://learnflow-ai-0fdz.onrender.com/static/logo.png",
      "sameAs": [
        "https://twitter.com/learnflowai",
        "https://facebook.com/learnflowai"
      ],
      "description": "LearnFlow AI empowers educators across Africa with multilingual quizzes, books, and videos."
    }

   </script>


    <style>

        
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        
        /* ðŸ”¥ UNIVERSAL DRAWER STYLES (Applies to all screens) ðŸ”¥ */
        #mobile-menu {
            /* Full-screen overlay */
            display: none; /* Controlled by JS active class */
            position: fixed; /* Fixed position to cover viewport */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1000; /* High z-index to cover everything */
            /* Add a semi-transparent backdrop for visual focus */
            background-color: rgba(0, 0, 0, 0.7); 
            /* Enable transition for smooth reveal */
            transition: opacity 0.3s ease-in-out;
            opacity: 0;
            overflow: hidden; /* Prevent body scroll bleed */
            padding: 0; /* Remove padding from container */
        }
        
        /* The actual drawer content that slides in from the LEFT */
        #mobile-menu-content {
            position: absolute;
            top: 0;
            left: 0; /* Align to the LEFT for sidebar effect */
            right: auto; /* Ensure right is not set */
            width: 80%; /* Takes up 80% of the screen width */
            max-width: 320px; /* Cap the width for large screens/desktop */
            height: 100%;
            background-color: #1e293b; /* slate-800 - The drawer's main background */
            /* Start off-screen to the LEFT, using a professional transition curve */
            transform: translateX(-100%); 
            transition: transform 0.4s cubic-bezier(0.8, 0, 0.2, 1);
            box-shadow: 4px 0 20px rgba(0, 0, 0, 0.7); /* Shadow for depth, cast on the right edge */
        }

        /* Active state for the full-screen overlay */
        #mobile-menu.active {
            display: block;
            opacity: 1;
        }
        
        /* Active state for the content to slide it fully into view */
        #mobile-menu.active #mobile-menu-content {
            transform: translateX(0); 
        }

        /* The menu button is now ALWAYS visible on all screens */
        @media (min-width: 768px) {
            /* Remove all old desktop nav overrides */
        }
    </style>
</head>
<body class="bg-slate-900 text-gray-200 min-h-screen flex flex-col">

    <nav class="bg-slate-800 p-4 shadow-xl sticky top-0 z-50 border-b-2 border-indigo-600/50">
        <div class="container mx-auto flex justify-between items-center relative">
            
            <button id="mobile-menu-button" class="text-gray-300 hover:text-white focus:outline-none p-1 rounded-md transition-colors duration-300" aria-label="Toggle navigation drawer">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-menu">
                    <line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/>
                </svg>
            </button>
            
            <a href="{% url 'aiapp:home' %}" class="absolute left-1/2 transform -translate-x-1/2 text-3xl font-extrabold text-indigo-400 hover:text-indigo-300 transition-colors tracking-wide">
                LearnFlow <span class="text-indigo-600">AI</span>
            </a>
            
            <div class="w-[28px] h-[28px]"></div>

        </div>
    </nav>

    <div id="mobile-menu">
        <div id="mobile-menu-content" class="p-6 flex flex-col h-full">
            
            <div class="flex justify-between items-center mb-8 border-b border-slate-700 pb-4">
                <h2 class="text-2xl font-bold text-indigo-400">Navigation</h2>
                <button id="mobile-menu-close-button" class="text-gray-400 hover:text-white focus:outline-none p-1 rounded-md transition-colors duration-300" aria-label="Close menu">
                    <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"/><path d="m6 6 12 12"/></svg>
                </button>
            </div>

            {% with request.path as current_path %}
            
            {% if user.is_authenticated %}
            <a href="{% url 'user:profile_detail' user.username %}" class="flex items-center space-x-4 mb-6 p-4 bg-slate-700/50 rounded-xl hover:bg-slate-700 transition-colors duration-300 cursor-pointer border border-slate-700 hover:border-indigo-600">
                 <div class="w-10 h-10 bg-indigo-600 rounded-full flex items-center justify-center text-white text-lg font-bold shadow-lg">
                    {{ user.username.0|upper }} 
                </div>
                <div>
                    <p class="text-sm font-semibold text-white">Hello, {{ user.username|title }}</p>
                    <p class="text-xs text-indigo-300 hover:text-indigo-200 transition-colors duration-300">View Profile â†’</p>
                </div>
            </a>
            {% endif %}

            <div class="space-y-2 flex-grow overflow-y-auto">
                
                <p class="text-sm font-semibold text-gray-500 pb-1 uppercase tracking-wider">Content & Tools</p>
                
                <a href="{% url 'legalpages:learnflow_main' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center text-lg font-medium {% if 'video_analysis/' in current_path or current_path == '/' %}text-white bg-indigo-600 shadow-lg border border-indigo-700/50{% else %}text-white bg-slate-700 hover:bg-indigo-700{% endif %}">
                   <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-bot mr-3"><path d="M12 8V4"/><rect width="16" height="12" x="4" y="8" rx="2"/><path d="M2 14h2"/><path d="M20 14h2"/><path d="M7 15h10"/><path d="M8 9v2"/><path d="M16 9v2"/></svg>
                   AI Video Analysis
                </a>
                
                <a href="{% url 'video:video_list' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center text-lg font-medium {% if 'videos/' in current_path %}text-indigo-400 bg-slate-700 shadow-inner border border-indigo-600/50{% else %}text-gray-300 hover:text-white hover:bg-slate-700{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-play-circle mr-3"><circle cx="12" cy="12" r="10"/><polygon points="10 8 16 12 10 16 10 8"/></svg>
                    Videos
                </a>
                
                <a href="{% url 'aiapp:quiz_list' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center text-lg font-medium {% if 'quiz/' in current_path and 'create' not in current_path and 'teacher' not in current_path %}text-indigo-400 bg-slate-700 shadow-inner border border-indigo-600/50{% else %}text-gray-300 hover:text-white hover:bg-slate-700{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-clipboard-list mr-3"><rect width="8" height="4" x="8" y="2"/><path d="M16 4h2a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V6a2 2 0 0 1 2-2h2"/><path d="M12 11h4"/><path d="M12 16h4"/><path d="M8 11h.01"/><path d="M8 16h.01"/></svg>
                    Quizzes
                </a>
                
                <a href="{% url 'book:book_list' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center text-lg font-medium {% if 'book/' in current_path %}text-indigo-400 bg-slate-700 shadow-inner border border-indigo-600/50{% else %}text-gray-300 hover:text-white hover:bg-slate-700{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-book-text mr-3"><path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H20v20H6.5a2.5 2.5 0 0 1 0-5H20"/><path d="M8 8h6"/><path d="M8 12h8"/></svg>
                    Books
                </a>
                
                {% if user.is_authenticated %}
                <p class="text-sm font-semibold text-gray-500 mt-6 pb-1 uppercase tracking-wider">Your Flow</p>

                <a href="{% url 'aiapp:teacher_quiz_dashboard' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center font-medium {% if 'teacher_quiz_dashboard/' in current_path %}text-indigo-400 bg-slate-700 shadow-inner border border-indigo-600/50{% else %}text-gray-300 hover:text-white hover:bg-slate-700{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-layout-dashboard mr-3"><rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/></svg>
                    My Dashboard
                </a>
                
                <a href="{% url 'aiapp:create_quiz' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center font-medium {% if 'create_quiz/' in current_path %}text-indigo-400 bg-slate-700 shadow-inner border border-indigo-600/50{% else %}text-gray-300 hover:text-white hover:bg-slate-700{% endif %}">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-file-plus mr-3"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/><line x1="12" x2="12" y1="18" y2="12"/><line x1="9" x2="15" y1="15" y2="15"/></svg>
                    Create Quiz
                </a>
                {% endif %}

                <p class="text-sm font-semibold text-gray-500 mt-6 pb-1 uppercase tracking-wider">Information</p>
                <a href="{% url 'legalpages:overview' %}" class="block py-3 px-4 rounded-xl transition-colors duration-300 flex items-center text-lg font-medium {% if current_path == '/overview/' %}text-indigo-400 bg-slate-700 shadow-inner border border-indigo-600/50{% else %}text-gray-300 hover:text-white hover:bg-slate-700{% endif %}">
                   <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info mr-3"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                   Overview
                </a>

            </div>
            
            <div class="mt-4 pt-4 border-t border-slate-700">
                {% if user.is_authenticated %}
                <form action="{% url 'user:logout' %}" method="post">
                    {% csrf_token %}
                    <button type="submit" class="w-full px-4 py-3 bg-rose-600 text-white rounded-xl hover:bg-rose-700 transition-all duration-300 shadow-lg font-semibold text-center text-lg transform hover:scale-[1.01] focus:ring-4 focus:ring-rose-500/50">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-out inline-block mr-2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                        Logout
                    </button>
                </form>
                {% else %}
                <a href="{% url 'user:login' %}" class="w-full px-4 py-3 bg-indigo-600 text-white rounded-xl hover:bg-indigo-700 transition-all duration-300 shadow-lg font-bold text-center block text-lg transform hover:scale-[1.01] focus:ring-4 focus:ring-indigo-500/50">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-log-in inline-block mr-2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
                    Login / Sign Up
                </a>
                {% endif %}
            </div>
            {% endwith %}
        </div>
    </div>
    </nav>

    <main class="container mx-auto p-4 flex-grow">
        {% if messages %}
            <div class="mb-4">
                {% for message in messages %}
                    <div class="p-3 mb-2 rounded-md font-medium text-sm {% if message.tags %}bg-{{ message.tags }}-800 text-{{ message.tags }}-300{% else %}bg-green-800 text-green-300{% endif %}">
                        {{ message }}
                    </div>
                {% endfor %}
            </div>
        {% endif %}

        {% block content %}
        {% endblock %}
    </main>

    <script>
        const mobileMenu = document.getElementById('mobile-menu');
        const mobileMenuButton = document.getElementById('mobile-menu-button');
        const mobileMenuCloseButton = document.getElementById('mobile-menu-close-button'); 

        // Function to open the menu
        function openMenu() {
            mobileMenu.classList.add('active');
            // Prevent body scrolling when the menu is open
            document.body.style.overflow = 'hidden'; 
        }

        // Function to close the menu
        function closeMenu() {
            mobileMenu.classList.remove('active');
            // Re-enable body scrolling
            document.body.style.overflow = '';
        }

        // Event listener for the toggle button
        mobileMenuButton.addEventListener('click', () => {
            if (mobileMenu.classList.contains('active')) {
                closeMenu();
            } else {
                openMenu();
            }
        });

        // Close when the 'X' button is clicked
        mobileMenuCloseButton.addEventListener('click', closeMenu);

        // Close when clicking the backdrop (outside the drawer content)
        mobileMenu.addEventListener('click', (event) => {
            // Check if the click target is the overlay itself, not a child element within the drawer content
            if (event.target === mobileMenu) {
                closeMenu();
            }
        });
        
        // Close menu on escape key press for better accessibility
        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && mobileMenu.classList.contains('active')) {
                closeMenu();
            }
        });

    </script>

    {% block extra_js %}
    <script>
        // NEW: Helper function to retrieve the CSRF token from the cookie
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    </script>
    {% endblock %}
</body>
</html>